import React,{useEffect,useState,useContext} from 'react'; import { useParams, Link, useNavigate } from 'react-router-dom'; import API from '../api'; import Header from '../components/Header'; import { AuthContext } from '../context/AuthContext';
export default function CarPage(){ const {id} = useParams(); const [car,setCar]=useState(null); const [start,setStart]=useState(''); const [end,setEnd]=useState(''); const {user} = useContext(AuthContext); const nav = useNavigate();
  useEffect(()=>{ API.get('/cars/'+id).then(r=>setCar(r.data)).catch(()=>{}); },[id]);
  const book = async ()=>{ if(!user){ alert('Prisijunkite'); nav('/login'); return; } if(!start||!end){ alert('Pasirinkite datas'); return; } try{ await API.post('/reservations', { carId:id, startDate:start, endDate:end }); alert('Rezervuota'); nav('/reservations'); }catch(e){ alert(e.response?.data?.message||e.message); } };
  return (<div><Header /><div className='content'><div className='car-detail'>{car? (<><img src={car.image||'/placeholder.png'} alt='' /><div className='info'><h2>{car.make} {car.model}</h2><p>Automobilio aprašymas: {car.description}</p><p>Klasė: {car.carClass}</p><p>Metai: {car.year}</p><p>Kaina: {car.pricePerDay} €/day</p><div className='calendar'><label>nuo <input type='date' value={start} onChange={e=>setStart(e.target.value)} /></label><label>iki <input type='date' value={end} onChange={e=>setEnd(e.target.value)} /></label></div><button onClick={book} className='btn'>Rezervuoti</button> <button className='btn pay'>Apmokėti</button>{user?.role==='admin' && <Link to={'/admin/add'} className='btn'>Koreguoti</Link>}</div></>):<p>Loading...</p>}</div></div><footer className='footer'>Kontaktai</footer></div>); }