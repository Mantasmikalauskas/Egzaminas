
import express from 'express'; import dotenv from 'dotenv'; import cors from 'cors'; import path from 'path'; import 'express-async-errors'; import connectDB from './config/db.js'; import authRoutes from './routes/authRoutes.js'; import carRoutes from './routes/carRoutes.js'; import reservationRoutes from './routes/reservationRoutes.js'; import uploadRoutes from './routes/uploadRoutes.js'; import siteRoutes from './routes/siteRoutes.js'; import errorHandler from './middleware/errorMiddleware.js'; dotenv.config(); const app = express(); app.use(cors({ origin: process.env.FRONTEND_URL || true })); app.use(express.json()); app.use('/api/auth', authRoutes); app.use('/api/cars', carRoutes); app.use('/api/reservations', reservationRoutes); app.use('/api/upload', uploadRoutes); app.use('/api/site', siteRoutes); app.get('/api/ping', (req,res)=>res.json({ok:true})); const __dirname = path.resolve(); app.use('/uploads', express.static(path.join(__dirname, '../uploads'))); app.use(errorHandler); const PORT = process.env.PORT || 5000; connectDB(process.env.MONGO_URI || 'mongodb://127.0.0.1:27017/cars_demo').then(()=> app.listen(PORT, ()=> console.log('Mongo connected\nServer', PORT))).catch(err => { console.error(err); process.exit(1); });
