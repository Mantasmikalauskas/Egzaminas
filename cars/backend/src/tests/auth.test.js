import request from 'supertest'; import mongoose from 'mongoose'; import { MongoMemoryServer } from 'mongodb-memory-server'; import app from '../index.js'; let mongo; beforeAll(async ()=>{ mongo = await MongoMemoryServer.create(); const uri = mongo.getUri(); await mongoose.connect(uri); }); afterAll(async ()=>{ await mongoose.disconnect(); await mongo.stop(); }); describe('auth', ()=>{ it('register and login', async ()=>{ const reg = await request(app).post('/api/auth/register').send({name:'Test',email:'test@x.com',password:'pw'}).expect(201); const login = await request(app).post('/api/auth/login').send({email:'test@x.com',password:'pw'}).expect(200); expect(login.body.token).toBeTruthy(); }); });